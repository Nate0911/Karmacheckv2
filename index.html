<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KarmaCheck v2  HAHAH</title>
</head>
<body>
  <h1>Welcome to KarmaCheck V2 HAHAHA</h1>

  <!-- Login with Reddit -->
  <a id="loginBtn" href="#" style="font-size:20px;">ğŸ”— Login with Reddit</a>

  <div id="userInfo" style="margin-top: 30px;"></div>

  <script>
    const client_id = "TPabIm5SP2bHaRivrF6zfQ";
    const redirect_uri = "https://nate0911.github.io/Karmacheckv2/";
    const scope = "identity history read";
    const state = "karma123"; // Use a random string to prevent CSRF

    // Step 1: Redirect to Reddit login if needed
    document.getElementById("loginBtn").href =
      `https://www.reddit.com/api/v1/authorize?client_id=${client_id}` +
      `&response_type=token` +
      `&state=${state}` +
      `&redirect_uri=${encodeURIComponent(redirect_uri)}` +
      `&duration=temporary` +
      `&scope=${encodeURIComponent(scope)}`;

    // Step 2: After redirect, grab the token from the URL
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    const access_token = params.get("access_token");

    if (access_token) {
      fetch("https://oauth.reddit.com/api/v1/me", {
        headers: {
          Authorization: `bearer ${access_token}`,
          "User-Agent": "KarmaCheckV2 by u/yourusername"
        }
      })
      .then(res => res.json())
      .then(user => {
        document.getElementById("userInfo").innerHTML = `
          <h2>ğŸ‘¤ Logged in as: ${user.name}</h2>
          <p>ğŸ’¯ Link karma: ${user.link_karma}</p>
          <p>ğŸ’¬ Comment karma: ${user.comment_karma}</p>
        `;
      })
      .catch(err => {
        console.error("Failed to fetch Reddit user:", err);
        document.getElementById("userInfo").textContent = "âŒ Failed to load user info.";
      });
    }
  </script>
</body>
</html>
